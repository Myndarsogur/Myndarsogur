<!DOCTYPE html>
<html lang="is">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#b00000" id="themeColor">
  <title>Höfundar</title>
  <style>
    /* Letur */
    @font-face{
      font-family: "CCBiffBamBoom";
      src: url("fonts/CCBiffBamBoom.woff2") format("woff2"),
           url("fonts/CCBiffBamBoom.woff") format("woff");
      font-display: swap;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:#b00000; /* rauður; uppfærist per höfund */
      color:#fff;
      display:grid;
      place-items:center;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, Helvetica, Arial, "Noto Sans", sans-serif;
      transition: background-color .35s ease;
    }

    .stage{
      width:min(1000px, 94vw);
      display:grid;
      gap:16px;
      position:relative;
      padding:20px 0 28px;
    }

    /* Kort: bara nafn + mynd */
    .card{
      display:grid;
      grid-template-columns: 1fr 1.1fr;
      gap: clamp(12px, 4vw, 28px);
      align-items:center;
      position: relative;
      z-index: 2; /* ofan á navzone */
    }
    @media (max-width:820px){
      .card{ grid-template-columns: 1fr; }
    }

    .name{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:clamp(8px, 3vw, 18px);
      font-family:"CCBiffBamBoom", Impact, Haettenschweiler, "Arial Black", sans-serif;
      font-size:clamp(32px, 8vw, 68px);
      line-height:.95;
      margin:0;
      text-wrap:balance;
      letter-spacing:.3px;
      text-shadow: 0 2px 0 rgba(0,0,0,.25);
    }
    /* Gerum nafnið að hlekk en látum það líta út eins og haus */
    .name a{
      color:inherit;
      text-decoration:none;
      cursor:pointer;
    }
    .name a:hover{ text-decoration: underline; text-underline-offset: 4px; }

    .name-nav{
      appearance:none;
      border:0;
      background:transparent;
      color:#fff;
      font-family:"CC Kiss And Tell", "CCBiffBamBoom", Impact, sans-serif;
      font-size:clamp(28px, 6vw, 44px);
      line-height:1;
      cursor:pointer;
      padding:0 clamp(8px, 2vw, 16px);
      transition:transform .2s ease, opacity .2s ease;
    }
    .name-nav:hover,
    .name-nav:focus-visible{
      transform:translateY(-2px);
      opacity:1;
      outline:2px solid rgba(255,255,255,0.75);
      outline-offset:4px;
    }
    .name-nav:active{ transform:translateY(0); }

    .portrait-wrap{
      width:100%;
      aspect-ratio: 4 / 5;
      border-radius: 18px;
      overflow:hidden;
      border:2px solid rgba(255,255,255,.22);
      background: rgba(255,255,255,.06);
      cursor:pointer; /* sýna að hægt sé að smella */
      position: relative;
    }
    .portrait{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
      transition:opacity .35s ease;
    }
    .portrait.is-loading{ opacity:0; }

    .info{
      border:1px solid rgba(255,255,255,0.28);
      border-radius:14px;
      padding:14px;
      background:rgba(255,255,255,0.06);
      color:#fff;
      box-shadow:0 10px 30px rgba(0,0,0,0.12);
    }
    .info p{margin:0 0 10px;}
    .meta{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      font-size:14px;
      color:rgba(255,255,255,0.85);
    }
    .works{
      list-style:none;
      margin:8px 0 0;
      padding:0;
      display:grid;
      gap:6px;
      color:#f8f8f8;
    }
    .works li{
      background:rgba(255,255,255,0.05);
      border:1px solid rgba(255,255,255,0.12);
      border-radius:10px;
      padding:8px 10px;
    }
    .works strong{display:inline-block; margin-right:6px;}

    .arrow-nav{ display:flex; justify-content:center; gap:clamp(28px, 12vw, 56px); margin-top:12px; }
    .arrow-btn{
      pointer-events:auto;
      appearance:none;
      border:0;
      background:transparent;
      color:#fff;
      font-family:"CC Kiss And Tell", "CCBiffBamBoom", Impact, sans-serif;
      font-size:clamp(36px, 12vw, 60px);
      line-height:1;
      padding:clamp(10px, 3vw, 16px) clamp(28px, 7vw, 40px);
      cursor:pointer;
      transition:transform .2s ease, opacity .2s ease;
    }
    .arrow-btn:hover,
    .arrow-btn:focus-visible{
      transform:translateY(-3px);
      opacity:1;
      outline:2px solid rgba(255,255,255,0.8);
      outline-offset:4px;
    }
    .arrow-btn:active{ transform:translateY(0); }
    .arrow-btn[disabled]{ opacity:0.3; cursor:default; transform:none; outline:none; }

    /* Vinstri/hægri klikksvæði undir kortinu (fyrir flettingu í auðu svæði) */
    .navzone{ position:absolute; top:0; bottom:0; width:50%; z-index:1; }
    .prev{ left:0; } .next{ right:0; }
    .navzone:active{ background: rgba(255,255,255,.03); }

    /* Dots */
    footer{ display:flex; justify-content:center; gap:0; flex-wrap:wrap; position: relative; z-index: 2; }
    .dot{ display:none; }

    /* Respect reduced motion */
    @media (prefers-reduced-motion: reduce){
      *{ transition:none !important; animation:none !important; }
    }
  </style>
</head>
<body>
  <div class="stage" role="application" aria-label="Fletting á milli höfunda">
    <div class="card" id="card">
      <!-- Nafnið er núna hlekkur -->
      <h2 class="name" id="name">
        <a id="nameLink" href="#" target="_blank" rel="noopener">—</a>
      </h2>

      <!-- Myndin er EKKI hlekkur — hún stýrir flettingu -->
      <div id="portraitWrap" class="portrait-wrap" aria-label="Smelltu á vinstri/hægri helming til að fletta">
        <img id="portrait" class="portrait" src="" alt="Höfundamynd" loading="lazy" decoding="async">
      </div>
    </div>

    <section class="info" aria-label="Um höfund">
      <p id="authorBio">Upplýsingar vantar um þennan höfund.</p>
      <div class="meta">
        <span id="authorLinks">Vefur / samfélagsmiðlar: —</span>
        <span id="authorEmail">Tölvupóstur: —</span>
      </div>
      <ul class="works" id="authorWorks" aria-label="Verk höfundar"></ul>
    </section>

    <footer id="dots" aria-label="Staða"></footer>
    <div class="arrow-nav" aria-hidden="false">
      <button type="button" class="arrow-btn" id="arrowPrev" aria-label="Fletta til baka">←</button>
      <button type="button" class="arrow-btn" id="arrowNext" aria-label="Fletta áfram">→</button>
    </div>

    <!-- hálfskjás-klikk (heldur áfram að virka í auðu svæðunum) -->
    <div class="navzone prev" title="Fletta til baka" aria-label="Fletta til baka"></div>
    <div class="navzone next" title="Fletta áfram" aria-label="Fletta áfram"></div>
  </div>

  <script>
    const DATA_URL = "../../Hofundar2/authors.json";
    const mediaBase = "Birt";
    const slidesByFolder = {
      "Bjarni Pálsson": [
        "mynd1.avif"
      ],
      "Einar Másson": [
        "mynd1.avif"
      ],
      "Fannar G. Gilbertsson": [
        "mynd1.avif",
        "mynd2.avif",
        "mynd3.avif",
        "mynd4.avif",
        "mynd5.avif",
        "mynd6.avif",
        "mynd7.avif",
        "mynd8.avif"
      ],
      "Gísli Dan": [
        "mynd1.avif",
        "mynd2.avif",
        "mynd3.avif",
        "mynd4.avif",
        "mynd5.avif"
      ],
      "Heiða Maack": [
        "mynd1.avif"
      ],
      "Hekla Art": [
        "mynd1.avif",
        "mynd2.avif",
        "mynd3.avif",
        "mynd4.avif",
        "mynd5.avif",
        "mynd6.avif",
        "mynd7.avif"
      ],
      "I.R. Kjartansson": [
        "mynd1.avif"
      ],
      "J.J. Mancho": [
        "mynd1.avif"
      ],
      "KRishelga": [
        "mynd1.avif",
        "mynd2.avif",
        "mynd3.avif",
        "mynd4.avif",
        "mynd5.avif",
        "mynd6.avif"
      ],
      "Krummi": [
        "mynd1.avif"
      ],
      "Lefteris Jakúmakis": [
        "mynd1.avif"
      ],
      "Lúkas Stefán Regal": [
        "mynd1.avif"
      ],
      "María Carmela": [
        "mynd1.avif"
      ],
      "Plóma": [
        "mynd1.avif"
      ],
      "Sigfús Jóhannsson": [
        "mynd1.avif",
        "mynd2.avif",
        "mynd3.avif",
        "mynd4.avif",
        "mynd5.avif",
        "mynd6.avif",
        "mynd7.avif",
        "mynd8.avif"
      ],
      "Sunneva Guðrún": [
        "mynd1.avif",
        "mynd2.avif",
        "mynd3.avif",
        "mynd4.avif",
        "mynd5.avif",
        "mynd6.avif",
        "mynd7.avif"
      ],
      "Sunneva Thomsen": [
        "mynd1.avif"
      ],
      "Þórir Karl Celin": [
        "mynd1.avif",
        "mynd2.avif",
        "mynd3.avif",
        "mynd4.avif",
        "mynd5.avif",
        "mynd6.avif",
        "mynd7.avif"
      ]
    };

    function encodeSegment(segment){
      return encodeURIComponent(segment).replace(/%2F/g, "/");
    }

    function buildSlidePath(folder, file){
      return `${mediaBase}/${encodeSegment(folder)}/${encodeSegment(file)}`;
    }

    const authors = [
      { name: "María Carmela",        url: "https://www.instagram.com/mct.art/?hl=en",                      folder: "María Carmela" },
      { name: "Bjarni Pálsson",       url: "https://www.jolaljosamadurinn.com/",                            folder: "Bjarni Pálsson" },
      { name: "Sunneva Thomsen",      url: "https://www.instagram.com/sunnevaart/?hl=en",                   folder: "Sunneva Thomsen" },
      { name: "Sunneva Guðrún",       url: "https://www.instagram.com/greykolla/?hl=en",                    folder: "Sunneva Guðrún" },
      { name: "Krummi",               url: "https://www.instagram.com/kruzidula/?hl=en",                    folder: "Krummi" },
      { name: "Lefteris Jakúmakis",   url: "https://left-y.com/",                                           folder: "Lefteris Jakúmakis" },
      { name: "J.J. Mancho",          url: "https://www.domestika.org/es/jjmancho/portfolio",               folder: "J.J. Mancho" },
      { name: "Sigfús Jóhannsson",    url: "https://www.instagram.com/sigfus_johannsson/?hl=en",            folder: "Sigfús Jóhannsson" },
      { name: "Þórir Karl Celin",     url: "https://celin.myportfolio.com/",                                folder: "Þórir Karl Celin" },
      { name: "Lúkas Stefán Regal",   url: "https://www.instagram.com/lukas_regal/?hl=en",                  folder: "Lúkas Stefán Regal" },
      { name: "Fannar G. Gilbertsson",url: "https://fannargg.com",                                          folder: "Fannar G. Gilbertsson" },
      { name: "Heiða Maack",          url: "https://www.instagram.com/dimma_limm/?hl=en",                   folder: "Heiða Maack" },
      { name: "Plóma",                url: "https://www.webtoons.com/en/canvas/goblin-behaviour/list?title_no=733332", folder: "Plóma" },
      { name: "I.R. Kjartansson",     url: "https://www.instagram.com/i.r.kjartansson_/?hl=en",             folder: "I.R. Kjartansson" },
      { name: "Hekla Art",            url: "https://www.instagram.com/jheklaart/?hl=en",                    folder: "Hekla Art" },
      { name: "Gísli Dan",            url: "https://www.instagram.com/gisli.dan.illustrations/?hl=en",      folder: "Gísli Dan" },
      { name: "Einar Másson",         url: "https://emassonart.com",                                        folder: "Einar Másson" }
      // Bættu auðveldlega við fleiri höfunda með því að bæta við möppu í Birt og skrá hana hér.
    ];

    authors.forEach((author) => {
      const files = slidesByFolder[author.folder] || [];
      const first = (files.length ? files : ["mynd1.jpg"])[0];
      author.slides = [buildSlidePath(author.folder, first)];
      author.bio = "Upplýsingar vantar um þennan höfund.";
      author.website = author.url || "";
      author.email = "";
      author.works = [];
    });

    const themeMeta     = document.getElementById("themeColor");
    const nameLinkEl    = document.getElementById("nameLink");
    const portraitEl    = document.getElementById("portrait");
    const portraitWrap  = document.getElementById("portraitWrap");
    const dotsEl        = document.getElementById("dots");
    const prevZone      = document.querySelector(".navzone.prev");
    const nextZone      = document.querySelector(".navzone.next");
    const bioEl         = document.getElementById("authorBio");
    const linksEl       = document.getElementById("authorLinks");
    const emailEl       = document.getElementById("authorEmail");
    const worksEl       = document.getElementById("authorWorks");
    const arrowPrevBtn = document.getElementById("arrowPrev");
    const arrowNextBtn = document.getElementById("arrowNext");

    let authorIndex = 0;
    const preloaded = new Set();

    function redShade(index, total){
      if(total < 2) return "hsl(0 80% 40%)";
      const t = index / (total - 1);
      const sat = 70 + 25 * (1 - t);
      const light = 58 - 58 * t;
      return `hsl(0 ${sat.toFixed(0)}% ${light.toFixed(0)}%)`;
    }

    function renderDots(){
      dotsEl.innerHTML = "";
      authors.forEach((author, idx) => {
        const dot = document.createElement("button");
        dot.type = "button";
        dot.className = "dot" + (idx === authorIndex ? " active" : "");
        dot.setAttribute("aria-label", `Fara í ${author.name}`);
        dot.addEventListener("click", () => {
          authorIndex = idx;
          render();
        });
        dotsEl.appendChild(dot);
      });
    }

    portraitEl.addEventListener("load", () => {
      portraitEl.classList.remove("is-loading");
    });

    function renderSlide(){
      const author = authors[authorIndex];
      const slides = author.slides;
      const src = slides[0];
      const alt = `${author.name}`;
      portraitEl.classList.add("is-loading");
      portraitEl.src = src;
      portraitEl.alt = alt;
    }

    function render(){
      const author = authors[authorIndex];
      nameLinkEl.textContent = author.name;
      if(author.url){
        nameLinkEl.href = author.url;
        nameLinkEl.setAttribute("target", "_blank");
        nameLinkEl.setAttribute("rel", "noopener");
      } else {
        nameLinkEl.href = "#";
        nameLinkEl.removeAttribute("target");
        nameLinkEl.removeAttribute("rel");
      }

      const bg = redShade(authorIndex, authors.length);
      document.body.style.background = bg;
      themeMeta.setAttribute("content", bg);
      document.title = `${author.name} — Höfundar`;

      bioEl.textContent = author.bio || "Upplýsingar vantar um þennan höfund.";
      const websiteLabel = author.website || author.url || "";
      linksEl.innerHTML = websiteLabel
        ? `Vefur / samfélagsmiðlar: <a href="${ensureUrl(websiteLabel)}" target="_blank" rel="noopener">${websiteLabel}</a>`
        : "Vefur / samfélagsmiðlar: —";
      emailEl.innerHTML = author.email
        ? `Tölvupóstur: <a href="mailto:${author.email}">${author.email}</a>`
        : "Tölvupóstur: —";
      const works = Array.isArray(author.works) ? author.works : [];
      worksEl.innerHTML = works.length
        ? works.map(w => `<li><strong>${w.title || "Verk"}</strong>${w.description ? ` – ${w.description}` : ""}</li>`).join("")
        : "<li>Engar upplýsingar um verk skráðar.</li>";

      renderDots();
      renderSlide();
      updateNavState();
    }

    function next(){
      if(authorIndex < authors.length - 1){
        authorIndex += 1;
        render();
      }
    }

    function prev(){
      if(authorIndex > 0){
        authorIndex -= 1;
        render();
      }
    }

    function updateNavState(){
      const canPrev = authorIndex > 0;
      const canNext = authorIndex < authors.length - 1;
      arrowPrevBtn.disabled = !canPrev;
      arrowNextBtn.disabled = !canNext;
    }

    nextZone.addEventListener("click", next);
    prevZone.addEventListener("click", prev);
    arrowNextBtn.addEventListener("click", next);
    arrowPrevBtn.addEventListener("click", prev);
    window.addEventListener("keydown", (e)=>{
      if(e.key === "ArrowRight") next();
      if(e.key === "ArrowLeft")  prev();
    });

    portraitWrap.addEventListener("click", (e)=>{
      const rect = portraitWrap.getBoundingClientRect();
      const x = e.clientX - rect.left;
      if(x < rect.width / 2){ prev(); } else { next(); }
    });

    let touchX = null;
    window.addEventListener("touchstart", (e)=>{ touchX = e.changedTouches[0].clientX; }, {passive:true});
    window.addEventListener("touchend", (e)=>{
      if(touchX == null) return;
      const dx = e.changedTouches[0].clientX - touchX;
      if(Math.abs(dx) > 40){ dx < 0 ? next() : prev(); }
      touchX = null;
    }, {passive:true});

    function normalizeName(str = ""){
      return str.toLowerCase()
        .replace(/á/g,"a").replace(/æ/g,"ae").replace(/ð/g,"d").replace(/é/g,"e").replace(/í/g,"i").replace(/ó/g,"o").replace(/ö/g,"o").replace(/ú/g,"u").replace(/ý/g,"y").replace(/þ/g,"th")
        .replace(/[^a-z0-9]/g,"");
    }

    function mergeAuthorData(remoteAuthors){
      const lookup = new Map();
      (remoteAuthors || []).forEach(a => {
        const names = [a.name, ...(a.aliases || [])].filter(Boolean);
        names.forEach(n => {
          lookup.set(normalizeName(n), a);
        });
      });
      // manual bridge for name variants
      const manual = {
        "fannarggilbertsson": "fannargilbertsson"
      };
      const isMissing = (val = "") => val.toLowerCase().startsWith("vantar");
      authors.forEach(author => {
        const key = normalizeName(author.name);
        let match = lookup.get(key);
        if(!match && manual[key]) match = lookup.get(manual[key]);
        if(match){
          author.bio = match.bio || author.bio;
          author.website = (match.website && !isMissing(match.website)) ? match.website : author.website;
          author.email = (match.email && !isMissing(match.email)) ? match.email : "";
          author.works = Array.isArray(match.works) ? match.works : [];
        }
      });
    }

    fetch(DATA_URL)
      .then(res => res.json())
      .then(data => {
        mergeAuthorData(data);
        render();
      })
      .catch(() => render());

  </script>
</body>
</html>
