<!DOCTYPE html>
<html lang="is">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Höfundar – Ómyndar</title>
  <style>
    @font-face{
      font-family:'HVComicSerif';
      src: url("../../assets/fonts/HVComicSerifotf.woff2") format("woff2"),
           url("../../assets/fonts/HVComicSerifotf.otf") format("opentype");
      font-display:swap;
    }
    @font-face{
      font-family:'CCBiffBamBoom';
      src: url("../../assets/fonts/CCBiffBamBoom.woff2") format("woff2");
      font-display:swap;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      padding:24px;
      font-family:'HVComicSerif', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, sans-serif;
      background:#f6f7fb;
      color:#0f172a;
      line-height:1.6;
    }
    .shell{
      max-width:900px;
      margin:0 auto;
      display:grid;
      gap:18px;
    }
    header{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:12px;
    }
    h1{
      margin:0;
      font-family:'CCBiffBamBoom','HVComicSerif', cursive;
      font-size:clamp(28px, 6vw, 40px);
      letter-spacing:0.4px;
    }
    a{color:inherit; text-decoration:none;}
    a:hover{text-decoration:underline;}
    .hero{
      width:100%;
      aspect-ratio:3/4;
      border:1px solid #e5e7eb;
      border-radius:12px;
      background:#fff;
      overflow:hidden;
      box-shadow:0 10px 30px rgba(0,0,0,0.08);
    }
    .hero img{width:100%; height:100%; object-fit:cover; display:block;}
    .card{
      border:1px solid #e5e7eb;
      border-radius:12px;
      padding:14px;
      background:#fff;
      box-shadow:0 8px 24px rgba(0,0,0,0.06);
    }
    .meta{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      font-size:14px;
      color:#475569;
    }
    ul{margin:0; padding-left:18px;}
    .works-gallery{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap:10px;
      margin-top:12px;
    }
    .work-thumb{
      border:1px solid #e5e7eb;
      border-radius:10px;
      padding:0;
      overflow:hidden;
      background:#f8fafc;
      cursor:pointer;
      box-shadow:0 6px 18px rgba(0,0,0,0.08);
    }
    .work-thumb img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }
    .muted{color:#6b7280; font-size:14px; margin:0;}
    .lightbox{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.65);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:16px;
      z-index:9999;
      opacity:0;
      pointer-events:none;
      transition:opacity .18s ease;
    }
    .lightbox.is-open{
      opacity:1;
      pointer-events:auto;
    }
    .lightbox__inner{
      position:relative;
      max-width: min(1100px, 92vw);
      max-height: 90vh;
      width:100%;
      background:#0b1120;
      border-radius:12px;
      overflow:hidden;
      box-shadow:0 16px 48px rgba(0,0,0,0.25);
    }
    .lightbox__inner img{
      display:block;
      width:100%;
      height:auto;
      max-height:90vh;
      object-fit:contain;
      background:#0b1120;
    }
    .lightbox__close{
      position:absolute;
      top:10px;
      right:10px;
      background:rgba(0,0,0,0.55);
      color:#fff;
      border:0;
      border-radius:50%;
      width:36px;
      height:36px;
      font-size:22px;
      cursor:pointer;
    }
  </style>
</head>
<body>
  <div class="shell">
    <header>
      <h1 id="authorTitle">Settu nafn hér</h1>
      <a href="../">← Til baka í forsíðu</a>
    </header>

    <div class="hero">
      <!-- Skiptu út myndinni fyrir höfundinn -->
      <img id="authorImg" src="cover-placeholder.jpg" alt="Höfundarmynd / forsíða">
    </div>

    <section class="card">
      <h2 style="margin:0 0 8px;">Um höfund</h2>
      <p style="margin:0 0 10px;" id="authorBio">Stutt kynning á höfundi. Segðu frá verkum, stíl og áherslum. Þú getur líka bætt við tenglum hér að neðan.</p>
      <div class="meta">
        <span id="authorLinks">Vefur / samfélagsmiðlar: <a href="#">hlekkur</a></span>
        <span id="authorEmail">Tölvupóstur: <a href="mailto:nafn@example.com">nafn@example.com</a></span>
      </div>
    </section>

    <section class="card">
      <h2 style="margin:0 0 8px;">Verk</h2>
      <ul id="authorWorks">
        <li>Verk / saga 1 – stutt lýsing, tengill ef þarf.</li>
        <li>Verk / saga 2</li>
        <li>Verk / saga 3</li>
      </ul>
      <div id="authorGallery" class="works-gallery" aria-label="Myndir úr verkum"></div>
    </section>
  </div>

  <script>
    const EDITION = "omyndar";
    const DATA_URL = "../../Hofundar2/authors.json";
    const PLACEHOLDER_IMG = "cover-placeholder.jpg";

    let authors = [];
    let idx = 0;

    const titleEl = document.getElementById("authorTitle");
    const imgEl = document.getElementById("authorImg");
    const bioEl = document.getElementById("authorBio");
    const linksEl = document.getElementById("authorLinks");
    const emailEl = document.getElementById("authorEmail");
    const worksEl = document.getElementById("authorWorks");
    const galleryEl = document.getElementById("authorGallery");

    const lightbox = document.createElement("div");
    lightbox.className = "lightbox";
    lightbox.innerHTML = `
      <div class="lightbox__inner">
        <button class="lightbox__close" aria-label="Loka">&times;</button>
        <img id="lightboxImg" alt="">
      </div>
    `;
    document.body.appendChild(lightbox);
    const lightboxImg = lightbox.querySelector("#lightboxImg");
    const closeBtn = lightbox.querySelector(".lightbox__close");

    const openLightbox = (img) => {
      if(!img || !img.src) return;
      lightboxImg.src = img.src;
      lightboxImg.alt = img.alt || "";
      lightbox.classList.add("is-open");
      document.body.style.overflow = "hidden";
    };
    const closeLightbox = () => {
      lightbox.classList.remove("is-open");
      document.body.style.overflow = "";
    };
    lightbox.addEventListener("click", (e) => {
      if(e.target === lightbox || e.target === closeBtn) closeLightbox();
    });
    document.addEventListener("keydown", (e) => {
      if(e.key === "Escape") closeLightbox();
    });

    const ensureUrl = (url) => {
      if (!url) return "";
      if (url.startsWith("http://") || url.startsWith("https://")) return url;
      return `https://${url}`;
    };
    const toArray = (val) => Array.isArray(val) ? val : (val ? [val] : []);

    function buildGallery(author){
      if(!galleryEl) return;
      const imgs = [];
      const seen = new Set();
      const addImage = (src, alt) => {
        if(!src || seen.has(src)) return;
        seen.add(src);
        imgs.push({src, alt});
      };
      (author.works || []).forEach(w => {
        toArray(w.images).forEach(src => addImage(src, w.title || author.name || "Mynd"));
      });
      toArray(author.gallery).forEach(src => addImage(src, author.name || "Mynd"));
      if(!imgs.length){
        galleryEl.innerHTML = '<p class="muted">Engar myndir skráðar enn.</p>';
        return;
      }
      galleryEl.innerHTML = imgs.map((img, i) => `
        <button class="work-thumb" data-idx="${i}" aria-label="Stækka mynd ${i+1}">
          <img src="${img.src}" alt="${img.alt || 'Mynd'}">
        </button>
      `).join("");
      galleryEl.querySelectorAll(".work-thumb").forEach(btn => {
        btn.addEventListener("click", () => {
          const item = imgs[Number(btn.dataset.idx)] || null;
          openLightbox(item);
        });
      });
    }

    function render() {
      if (!authors.length) return;
      const a = authors[idx];
      titleEl.textContent = a.name || "Nafn vantar";
      imgEl.alt = a.name || "Höfundarmynd";
      imgEl.src = a.image && a.image !== "vantar höfundamynd" ? a.image : PLACEHOLDER_IMG;
      bioEl.textContent = a.bio || "Upplýsingar vantar um þennan höfund.";
      linksEl.innerHTML = a.website && a.website !== "vantar vefslóð"
        ? `Vefur / samfélagsmiðlar: <a href="${ensureUrl(a.website)}" target="_blank" rel="noopener">${a.website}</a>`
        : "Vefur / samfélagsmiðlar: —";
      emailEl.innerHTML = a.email && a.email !== "vantar tölvupóst"
        ? `Tölvupóstur: <a href="mailto:${a.email}">${a.email}</a>`
        : "Tölvupóstur: —";
      worksEl.innerHTML = Array.isArray(a.works) && a.works.length
        ? a.works.map(w => `<li><strong>${w.title || "Verk"}</strong>${w.description ? ` – ${w.description}` : ""}</li>`).join("")
        : "<li>Engar upplýsingar um verk skráðar.</li>";
      buildGallery(a);
    }

    function next() {
      if (!authors.length) return;
      idx = (idx + 1) % authors.length;
      render();
    }
    function prev() {
      if (!authors.length) return;
      idx = (idx - 1 + authors.length) % authors.length;
      render();
    }

    document.addEventListener("keydown", (e) => {
      if(lightbox.classList.contains("is-open")) return;
      if (e.key === "ArrowRight") next();
      if (e.key === "ArrowLeft") prev();
    });
    document.addEventListener("click", (e) => {
      if(lightbox.classList.contains("is-open")) return;
      if (e.target.closest('a') || e.target.closest('section')) return;
      const mid = window.innerWidth / 2;
      if (e.clientX > mid) next(); else prev();
    });

    fetch(DATA_URL)
      .then(res => res.json())
      .then(data => {
        authors = (data || []).filter(a => (a.editions || []).includes(EDITION));
        if (!authors.length) {
          titleEl.textContent = "Engir höfundar fundust";
          bioEl.textContent = "Ekki tókst að hlaða höfunda fyrir þessa síðu.";
          return;
        }
        render();
      })
      .catch(() => {
        titleEl.textContent = "Villa við að hlaða höfunda";
        bioEl.textContent = "Ekki tókst að sækja gögn úr authors.json.";
      });
  </script>
</body>
</html>
